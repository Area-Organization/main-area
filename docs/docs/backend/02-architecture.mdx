---
title: Architecture & Schéma de Données
---

# Architecture & Schéma de Données

## Structure des Dossiers

Le backend suit une architecture modulaire :

```text
apps/backend/
├── prisma/
│   └── schema.prisma       # Définition des modèles de données
├── src/
│   ├── database/           # Client Prisma et configuration Better Auth
│   ├── hooks/              # Moteur de polling (manager.ts)
│   ├── interfaces/         # Définitions TypeScript des Services (IAction, IReaction)
│   ├── middlewares/        # Vérification d'authentification (session/token)
│   ├── plugins/            # Plugins Elysia (Swagger, Better Auth handler)
│   ├── routes/             # Contrôleurs API (areas, connect, about)
│   ├── services/           # Implémentation des services tiers
│   │   ├── discord/
│   │   ├── github/
│   │   ├── gmail/
│   │   ├── spotify/
│   │   ├── trello/
│   │   └── registry.ts     # Singleton centralisant tous les services
│   ├── utils/              # Utilitaires (ex: interpolator.ts)
│   ├── app.ts              # Configuration de l'application Elysia
│   └── index.ts            # Point d'entrée
└── tests/                  # Tests unitaires et d'intégration
```

## Bibliothèques Clés

Outre les technologies principales, le backend s'appuie sur des librairies spécifiques pour assurer la robustesse et la sécurité des types :

- **@sinclair/typebox**: Utilisé pour la validation des données à l'exécution et la génération de schémas JSON. Il garantit que les données entrantes (body, query params) respectent le format attendu.
- **@elysiajs/eden**: Permet de générer un client API type-safe pour les frontends (Web et Mobile). Cela assure une cohérence totale ("End-to-End Type Safety") : si le backend change une route, le frontend ne compile plus tant qu'il n'est pas mis à jour.

## Schéma de la Base de Données (Prisma)

Les modèles principaux définis dans `schema.prisma` sont :

- **User**: L'utilisateur central.
- **Session / Account**: Gérés par Better Auth pour les sessions actives et les liaisons OAuth.
- **UserConnection**: Stocke les crédentials (`accessToken`, `refreshToken`, `metadata`) pour un service spécifique (ex: "spotify") lié à un utilisateur. C'est ce qui permet au backend d'agir au nom de l'utilisateur.
- **Area**: Représente une automatisation active. Contient le compteur de déclenchements (`triggerCount`) et la date de dernière exécution (`lastTriggered`).
- **AreaAction**: Configuration du déclencheur (stocke les paramètres spécifiques comme `repoName`).
- **AreaReaction**: Configuration de la conséquence (stocke les paramètres comme `playlistId`).

## Types Partagés

Le backend dépend du package interne `@area/types` (situé dans `packages/types`) pour assurer que les DTOs (Data Transfer Objects) envoyés par l'API correspondent exactement à ce que les clients attendent.
