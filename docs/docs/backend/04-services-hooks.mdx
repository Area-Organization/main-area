---
title: Services & Moteur d'Automatisation
---

# Services et Moteur d'Automatisation

## Services Supportés

Le backend implémente actuellement les services suivants dans `src/services/` :

1.  **GitHub**:
    - _Actions_: `new_issue`, `new_star`.
    - _Réaction_: `create_issue`.
    - _Auth_: OAuth2.
2.  **Gmail**:
    - _Actions_: `new_email`, `new_email_with_attachment`.
    - _Réaction_: `send_email`.
    - _Auth_: OAuth2 (Google).
3.  **Discord**:
    - _Action_: `on_message` (Surveille un canal).
    - _Réaction_: `send_message`.
    - _Auth_: Bot Token (API Key).
4.  **Spotify**:
    - _Action_: `new_saved_track`.
    - _Réaction_: `add_to_playlist`.
    - _Auth_: OAuth2.
5.  **Trello**:
    - _Action_: `new_card_in_list`.
    - _Réaction_: `create_card`.
    - _Auth_: API Key + Token.

## Interpolation de Variables

Le système permet de passer des données dynamiques de l'action vers la réaction grâce au module `src/utils/interpolator.ts`.
Chaque action définit des `variables` disponibles.

**Exemple :**
L'action GitHub `new_issue` expose les variables `{{title}}` et `{{url}}`.
L'utilisateur peut configurer la réaction Discord avec le message :

> "Nouvelle issue créée : `{{title}}`. Lien : `{{url}}`"

Lors de l'exécution, le `HookManager` remplacera ces placeholders par les vraies valeurs.

## Le HookManager (`src/hooks/manager.ts`)

C'est le cœur du système :

1.  **Démarrage**: Appelé dans `index.ts`, il lance une boucle (`setInterval`) par défaut toutes les 60 secondes.
2.  **Polling**:
    - Récupère toutes les `AREA` actives (`enabled: true`).
    - Pour chaque AREA, instancie le service d'action concerné.
    - Appelle `action.check(params, context)`.
3.  **Vérification (`check`)**:
    - L'action compare l'état actuel de l'API externe avec les métadonnées stockées (`lastCheckedId`, `lastTimestamp`).
    - Si une nouveauté est détectée, `check` retourne `true` et remplit `context.actionData`.
    - Le `HookManager` met à jour les métadonnées en base de données.
4.  **Exécution (`execute`)**:
    - Si `check` est positif, le `HookManager` interpolate les paramètres de la réaction avec `actionData`.
    - Il appelle `reaction.execute(processedParams, context)`.
    - Il incrémente le compteur de déclenchements.
